<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador Financeiro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    
    {% if current_user.is_authenticated %}
    <div class="container">
        <nav class="sidebar" id="sidebar">
            <h3>Navegação</h3>
            <p style="padding: 0 5px; color: #555;">Olá, <strong>{{ current_user.username }}</strong>!</p>
            <a href="{{ url_for('index') }}" class="nav-all">Ver Todos os Gastos</a>
            <hr>
            
            <details class="month-accordion">
                <summary>Selecionar mês para visualização</summary>
                {% for nav in nav_months %}
                    <div class="nav-month">
                        <a href="{{ url_for('index', ano=nav.ano, mes=nav.mes) }}">{{ nav.nome }} / {{ nav.ano }}</a>
                    </div>
                {% endfor %}
            </details>
            
            <hr>
            
            <h4>Adicionar Gasto</h4>
            <form action="{{ url_for('index') }}" method="post" class="add-form">
                <div class="form-field">
                    <label for="descricao">Descrição:</label>
                    <input type="text" id="descricao" name="descricao" required>
                </div>
                <div class="form-group-inline">
                    <div class="form-field grow"><label for="valor">Valor:</label><input type="number" id="valor" name="valor" step="0.01" required></div>
                    <div class="form-field no-grow"><label for="moeda">Moeda:</label><select name="moeda" id="moeda" required>{% for moeda in moedas %}<option value="{{ moeda }}" {% if moeda == 'BRL' %}selected{% endif %}>{{ moeda }}</option>{% endfor %}</select></div>
                </div>
                <div class="form-field"><label for="categoria">Categoria:</label><select name="categoria" id="categoria" required onchange="toggleParcelasField()"><option value="" disabled selected>Selecione</option>{% for cat in categorias %}<option value="{{ cat }}">{{ cat }}</option>{% endfor %}</select></div>
                <div class="form-field" id="parcelas-field" style="display: none;"><label>Parcela:</label><div class="parcelas-group"><select name="parcela_atual" id="parcela-atual"></select><span class="parcela-separator">/</span><select name="parcela_total" id="parcela-total" onchange="updateParcelaAtualOptions('parcela-total', 'parcela-atual')">{% for i in range(1, 61) %}<option value="{{ i }}">{{ "%02d"|format(i) }}</option>{% endfor %}</select></div></div>
                <div class="form-field"><label for="data">Data:</label><input type="date" id="data" name="data" value="{{ current_date }}" min="{{ min_date }}" max="{{ current_date }}" required></div>
                <button type="submit">Adicionar</button>
            </form>
            
            <a href="{{ url_for('logout') }}" style="margin-top: auto; padding: 10px 5px; color: #d00000; font-weight: bold;">Sair</a>
        </nav>

        <div class="overlay" id="overlay"></div>

        <main class="content">
            <button class="sidebar-toggle" id="sidebar-toggle"><span></span><span></span><span></span></button>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert-{{ category }}" style="padding: 15px; margin-bottom: 20px; border-radius: 4px; text-align: center; background-color: #f8d7da; color: #721c24;">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            {% block content %}{% endblock %}
        </main>
    </div>
    
    <!-- Modais de Edição/Exclusão (Estrutura Original) -->
    <!-- (O código dos modais permanece aqui, sem alterações) -->
    <div id="delete-modal" class="modal">...</div>
    <div id="edit-modal" class="modal">...</div>
    <script>
        // (Todo o seu JavaScript original permanece aqui, sem alterações)
    </script>

    {% else %}
        <!-- Este bloco será usado pelas páginas de login/registo -->
        {% block auth_content %}{% endblock %}
    {% endif %}

</body>
</html>